# ログ分析結果 - 2025-11-23 (Turn 2で即死)

## 問題の詳細

**報告**: 2ターン目で速攻アウト。敵が近づかなかった。

## ログ分析

### Turn 1の状況

**プレイヤー位置**: `(39, 33)`

**敵の意図生成と移動**:
- `BP_EnemyUnitBase_C_0`: `(36,35)` → `(37,36)`に移動予定（斜め移動）
- `BP_EnemyUnitBase_C_1`: `(35,35)` → `(36,36)`に移動予定（斜め移動）
- `BP_EnemyUnitBase_C_2`: `(39,36)` → `(39,35)`に移動予定（縦移動）✅
- `BP_EnemyUnitBase_C_3`: `(37,33)` → `(38,33)`に移動予定（横移動）✅
- `BP_EnemyUnitBase_C_4`: 攻撃（プレイヤーに隣接）

**実際の移動**:
- `BP_EnemyUnitBase_C_0`: `(37, 36)`に予約
- `BP_EnemyUnitBase_C_2`: `(39, 35)`にCOMMIT
- `BP_EnemyUnitBase_C_3`: `(37, 34)`に予約（**注意**: 予定は`(38,33)`だったが、実際は`(37,34)`）

### Turn 2の状況

**Turn 2のログが存在しない** → ゲームオーバーになった可能性が高い

## 重大な問題

### 1. GetNextStepの詳細ログが出力されていない

`DistanceFieldSubsystem.cpp`に追加したログ（地形ブロック、候補評価など）が**全く出力されていない**。

**原因の可能性**:
1. `LogDistanceField`カテゴリのログレベルが`Log`より高い設定になっている
2. ログが大量すぎてフィルタリングされている
3. `GetNextStep`内部で早期リターンしている

**確認が必要**:
- DefaultEngine.iniの`LogDistanceField`設定
- コンソールコマンドでのログレベル設定

### 2. Enemy_3の移動先が予定と異なる

**予定**: `(37,33)` → `(38,33)`（GetNextStepの結果）
**実際**: `(37,33)` → `(37,34)`（GridOccupancyの予約）

これは、`ConflictResolver`が移動先を変更した可能性がある。

### 3. Enemy_0とEnemy_1の移動方向

プレイヤーは`(39,33)`にいるのに、Enemy_0とEnemy_1が斜め方向`(37,36)`と`(36,36)`に移動している。

**プレイヤーまでの距離**:
- Enemy_0 `(36,35)`: `(39-36, 33-35)` = `(3, -2)` → 右下方向
- Enemy_1 `(35,35)`: `(39-35, 33-35)` = `(4, -2)` → 右下方向

しかし、移動先は：
- Enemy_0: `(37,36)` → 右上方向（プレイヤーから遠ざかっている！）
- Enemy_1: `(36,36)` → 右上方向（プレイヤーから遠ざかっている！）

**これは明らかに間違っている！**

## 推測される原因

### 仮説1: DistanceFieldの計算が間違っている

プレイヤーが`(39,33)`にいるのに、DistanceFieldが逆方向を指している可能性。

### 仮説2: GetNextStepのロジックに問題がある

GoalDeltaの計算が間違っている、または候補評価のロジックに問題がある。

### 仮説3: 地形ブロックで正しい方向に移動できない

正しい方向（右下）が地形でブロックされているため、斜め上方向に移動している可能性。

**しかし、GetNextStepの詳細ログがないため確認できない。**

## 次のステップ

### 最優先: LogDistanceFieldのログを出力させる

1. **DefaultEngine.iniを確認**:
   ```ini
   [Core.Log]
   LogDistanceField=Log
   ```

2. **コンソールコマンドで有効化**:
   ```
   Log LogDistanceField Log
   ```

3. **再テストしてログ取得**

### 代替案: 手動でDistanceFieldの値を確認

`UpdateDistanceFieldInternal`に、プレイヤー周辺のDistanceField値をログ出力するコードを追加。

## 暫定的な結論

**Enemy_0とEnemy_1がプレイヤーから遠ざかる方向に移動している**ことが確認された。

これは、以下のいずれかが原因：
1. DistanceFieldの計算が間違っている
2. GetNextStepのロジックが間違っている
3. 地形ブロックで正しい方向に移動できない

**GetNextStepの詳細ログが出力されないため、原因を特定できない。**
